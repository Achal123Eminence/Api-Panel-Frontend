<div class="cricket-container">
  <div class="select-sport">
    <button class="top-btn" (click)="fetchCricketAllEventList('4')" [class.active]="selectedSport === '4'">Cricket Match</button>
    <button class="top-btn" (click)="fetchCricketAllEventList('1')" [class.active]="selectedSport === '1'">Soccer Match</button>
    <button class="top-btn" (click)="fetchCricketAllEventList('2')" [class.active]="selectedSport === '2'">Tennis Match</button>
  </div>
    <!-- <h1 class="main-heading">{{ selectedSport === '4' ? 'Cricket' : selectedSport === '1' ? 'Soccer' : selectedSport === '2' ? 'Tennis' : '' }} Events List</h1> -->
  <!-- Search & Page Size -->
  <div class="table-responsive" style="box-shadow: #000 0 2px 6px;">
    <div class="d-flex justify-content-between align-items-center p-2" style="background-color: #006e76;border-bottom: 1px solid #fff;">
      <div>
        <label class="me-2">Show</label>
        <select class="form-select d-inline-block w-auto" (change)="setPageSize($event)">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50" selected>50</option>
        </select>
        <label class="ms-2">entries</label>
      </div>
      <div>
        <input
          type="text"
          class="form-control"
          placeholder="Search..."
          style="max-width: 250px;"
          [value]="searchTerm()"
          (input)="onSearchChange($event)"
        />
      </div>
    </div>

    <!-- Table -->
    <table class="table table-striped mb-0">
      <thead>
        <tr>
          <th scope="col" style="width: 5%;">Sr.No</th>
          <!-- <th scope="col">EventId/MarketID</th> -->
          <th scope="col" style="width: 10%;">EventId</th>
          <th scope="col" style="width: 20%;">Event Name</th>
          <th scope="col" style="width: 30%;">Cmpt Id/Name</th>
          <th scope="col" style="width: 15%;">Open Date</th>
          <!-- <th scope="col">Sport Name</th> -->
          <!-- <th scope="col">Market Count</th> -->
          <th scope="col" style="width: 5%;">Provider</th>
          <th scope="col" style="width: 15%;text-align: center;">Action</th>
        </tr>
      </thead>
      <tbody>
        @for (item of paginatedList(); track $index) {
          <tr>
            <td scope="row">{{ ($index + 1) + ((currentPage()-1) * pageSize()) }}</td>
            <!-- <td>{{item.eventId}}/{{item.marketId}}</td> -->
            <td>{{item.eventId}}</td>
            <td>{{item.eventName}}</td>
            <td>
              <span>{{item.competitionId}}/</span>
              <span>{{item.competitionName}}</span>
              <!-- <div style="display: grid;">
              </div> -->
               <!-- {{item.competitionId}}/{{item.competitionName}}</td> -->
            <td>{{item.openDate | date:'dd-MM-yyyy HH:mm:ss'}}</td>
            <!-- <td>{{item.sportName}}</td> -->
            <td><span>Betfair</span></td>
            <td>
              <div style="display: flex;justify-content: left;gap: 1rem;">
                <button  class="events-btn" *ngIf="item.isAdded == false" (click)="openModal(item)" >Add</button>
                <button  class="events-btn" style="background-color: #012c58 !important;" *ngIf="item.isAdded == true">Added</button>
                <button *ngIf="item.marketName == 'Winner' && item.isAdded == false" class="events-btn purpel" style="margin-left: 3px;" (click)="openModal(item)">Cup Winner</button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="d-flex justify-content-between align-items-center p-2" style="background-color: #006e76;">
      <div class="entries-num">
        Showing <strong>{{ (currentPage()-1) * pageSize() + 1 }}</strong> to <strong>{{ Math.min(currentPage() * pageSize(), filteredList().length) }}</strong> of <strong>{{ filteredList().length }}</strong> entries
      </div>
      <nav>
        <ul class="pagination pagination-sm mb-0">
          <li class="page-item" [class.disabled]="currentPage() === 1">
            <a class="page-link" (click)="setPage(currentPage()-1)">Previous</a>
          </li>
          @for (page of [].constructor(totalPages()); track $index) {
            <li class="page-item" [class.active]="currentPage() === ($index+1)">
              <a class="page-link" (click)="setPage($index+1)">{{ $index+1 }}</a>
            </li>
          }
          <li class="page-item" [class.disabled]="currentPage() === totalPages()">
            <a class="page-link" (click)="setPage(currentPage()+1)">Next</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- Modal popup -->
<div class="modal fade" id="addEventModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Event Details</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="addEventForm" (ngSubmit)="addEvent()">

          <div class="mb-3">
            <label>Competition Grade</label>
            <select class="form-select" formControlName="competitionGrade">
              <option value="">Select</option>
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
            </select>
          </div>

          <div class="mb-3">
            <label>Event Grade</label>
            <select class="form-select" formControlName="eventGrade">
              <option value="">Select</option>
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
            </select>
          </div>

          <div *ngIf="selectedSport === '4' && selectedEvent?.marketName !== 'Winner'">
            <div class="mb-3">
              <label>Match Type</label>
              <select class="form-select" formControlName="matchType">
                <option value="">Select</option>
                <option value="t10">T10</option>
                <option value="t15">T15</option>
                <option value="100balls">100 Balls</option>
                <option value="t20">T20</option>
                <option value="oneDay">One Day</option>
                <option value="test">Test</option>
              </select>
            </div>
          
            <div class="mb-3">
              <label>Premium</label>
              <select class="form-select" formControlName="premium">
                <option value="">Select</option>
                <option [ngValue]="true">Yes</option>
                <option [ngValue]="false">No</option>
              </select>
            </div>
          
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-success" [disabled]="addEventForm.invalid">Add Event</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<div class="loader-overlay" *ngIf="isloading">
  <div class="spinner"></div>
</div>